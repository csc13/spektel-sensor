<!doctype html>
<html lang="en">
<meta charset="utf-8">
<title>Sensor setup &#8211; spektel-sensor</title>
<meta name="description" content="Assembly options and sensor setup">
<meta name="keywords" content="Atmel, AVR, microcontroller, XMEGA, XMEGA32E5, firmware">


<meta property="og:locale" content="en_US">
<meta property="og:title" content="Sensor setup &#8211; spektel-sensor">
<meta property="og:description" content="Assembly options and sensor setup">
<meta property="og:url" content="/articles/Sensor_setup">
<meta property="og:site_name" content="spektel-sensor">


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="spektel-sensor Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Type -->
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Crimson+Text:400,400italic,700,700italic" rel='stylesheet' type='text/css' />
<link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/assets/css/entypo.css" media="all">

<!-- In order to use Calendas Plus, you must first purchase it. Then, create a font-face package using FontSquirrel.
<link rel='stylesheet' href='/assets/cal.css' media='all' />
-->



<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/i.css">

<!-- Fresh Squeezed jQuery -->

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">

<div id="bump">
  <body class="">
    <header class="site-header">
      <div class="wrap">
        <hgroup>
          <h1><a href="/">spektel-sensor</a></h1>
        </hgroup>
        <a href="#nav" class="menu"><span class='icons'>☰</span></a>
        <nav role="navigation">
          <ul>
            <li>
              <a href="/" title="spektel-sensor">Home</a>
            </li>
            
            
                <li><a href="/about" >About</a></li>
            
                <li><a href="https://github.com/csc13/spektel-sensor" target="_blank">Github</a></li>
            

          </ul>
        </nav>
      </div>
    </header>


<section class="article">


  <div class="overlay"></div>
  <div class="featured-image" style="background-image: url(/images/Board_REV_B.jpg)"></div>



      <article class="wrap post">
        <header class="post-header">
          <hgroup>
            <h1>Sensor setup</h1>
            <p class="date">Dec 31, 2014</p>
            <p class="intro">Assembly options and sensor setup</p>
          </hgroup>
        </header>
    
        <p>The sensor firmware can be used with different configurations. Basically the firmeware should
be able to support different revisions of the sensor, several assembly options and be configurable
to different models and flight situations.</p>

<h3 id="assembly-options">Assembly options</h3>

<p>REV_B as the actual sensor can be assembled with different component options. The 
<code>Allegro ACS758LCB-100U-PFF-T</code> is as well available in a 50A and 200A version. 
This indicates the maximum measurement range of the hall sensor, while
it can take a current many times higher without damage. But using the 50A version
will give double the precision than the 100A version.</p>

<p>By changing the resistors (R7 and R8) of the voltage divider for the voltage measurement,
batteries with more than 6 cells can be supported as well as higher precision for less cells
can be enabled.</p>

<p>Another option is to omit the <code>Bosch BMP180</code> pressure sensor, if the altimeter and vario
functions are not needed. Unused connectors can be cut out as well.</p>

<h3 id="firmeware-setup">Firmeware setup</h3>
<p>One basic requirement is to setup the capacity of the used battery for the alarm.</p>

<p>While it is no problem to setup the sensor using the development environment, a target of
the project was to provide setup methods not requiring a development environment. The
hardware offers two general possibilities. One option is to use the <code>Serial port</code> via a
Serial-USB adaptor or a PC independent setup box. The second is to use the build
in button. The latter method can only provide basic setup functions.</p>

<h3 id="setup-parameters">Setup parameters</h3>
<p>Here is a list of useful setup parameters:</p>

<ul>
  <li>Capacity of the sensor in mAh</li>
  <li>Alarm threshold at a minimum capacity (in mAh) or as a percentage left of the max capacity (in %)</li>
  <li>An optional second alarm threshold for the capacity (as the Powerbox sensor has two capacity alarms</li>
  <li>A voltage threshold for the main battery voltage (in mV) or,</li>
  <li>The number of cells used and a calculated minimum voltage of the pack</li>
  <li>The hight of the airfield (in m), useful, if the flight can go below the airfield (in the mountains)</li>
  <li>Several calibration parameters to adjust the sensor to the used components</li>
</ul>

<h3 id="setup-on-the-airfield">Setup on the airfield</h3>
<p>The setup method for the airfield using the sensors button, allows only for setting up
the <strong>Capacity of the battery in mAh</strong>. The alarm (Cap1 alarm) will be activated, if the 
calculated capacity falls under 20% of this value.</p>

<p>For the setup start the transmitter with the model setup bound to the receiver used and the
Powerbox telemetry sensor activated. Now hold the button on the bottom side (backside of 
the XMEGA) pressed while powering the sensor. Note that the power for the sensor comes 
via the X-Bus, TM1000 and receiver from the receiver battery or BEC. The sensor will 
indicate the setup mode by blinking three times both LEDs. Release the button after the
first blinking of both LEDs.</p>

<p>Now the Cap1 display will count up by one hundred each second starting by zero again. If
the desired number is displayed press the button until the red LED goes out. Now the display
will loop through the thousands digit from 0 to 9. If the right number is displayed press the
button until the red LED lights up again. Now the same process starts for the ten thousands
digit, but only from 0 to 5. Press the button until the red LED lights up.</p>

<p>If the value is saved successfully to the EEPROM, the red LED goes out again. The sensor
can be used right away and will reload the stored capacity value on the next power up.</p>

<p><strong>To stop the setup process in between, cut the power of the sensor!</strong></p>

<h3 id="restrictions">Restrictions</h3>
<p>I implemented the setup function using a simple way. There are no interrupts, no debounce
of the button, etc. So you need to watch to the LED and release the button after the
red light changes. But hey, it is only the setup function, you won’t use it every day.</p>

<p>Since the capacity in the Spektrum X-Bus protocol uses a 16Bit
variable, the maximum is 65535mAh. For program simplicity the maximum battery capacity
is now limited to 50.000mAh, which should be good enough for most RC use cases.</p>

<h3 id="hook-up-diagramm">Hook up diagramm</h3>
<p>Since I have not given a hook up guide, I will provide a small sketch to see the basic
installation. To measure the main battery voltage, there needs to be a ground connection
between the sensor and the main battery negative pole. This is normally given by the BEC
system in the electronic speed controller. If not you need to wire an additional connection.</p>

<figure>
	<img src="/images/hook_up_diagram_REV_B.png" />
	<figcaption>Hook up diagram</figcaption>
</figure>

<h3 id="outlook">Outlook</h3>
<p>The serial port was intended to provide more sophisticated options for setting up
the sensor. Using a terminal program and a kind of AT commands this can be easily achieved.</p>

          
      <a class="share" href="https://twitter.com/intent/tweet?text=&quot;Sensor setup&quot;%20%20via%20&#64;" data-dnt="true">Share</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

      


      </article>

    </section>
</div>

<div class="push"></div>
  <footer>
    <aside class="wrap">
      <ol class="prev-posts">
        <p class="list-title">Recent Posts</p>
         <!-- for1 -->
            <li>
              <span class="recent-title"><a href="/articles/XMEGA_ASF_TWI" title="XMEGA, ASF and TWI/I2C">XMEGA, ASF and TWI/I2C </a></span>
              <span class="date">Jan 03, 2015</span>
            </li>
         <!-- for1 -->
            <li>
              <span class="recent-title"><a href="/articles/Sensor_setup" title="Sensor setup">Sensor setup </a></span>
              <span class="date">Dec 31, 2014</span>
            </li>
         <!-- for1 -->
            <li>
              <span class="recent-title"><a href="/articles/Software_part_1" title="Firmware Part 1">Firmware Part 1 </a></span>
              <span class="date">Dec 23, 2014</span>
            </li>
        
      </ol>
      
      <div class="social">
        <ul>
            <li><a id="mail" href="mailto:git@cescholz.de"><span class="foot-link">Contact Me</span></a></li>
            
            
            
            
            
        </ul>
    </div>
    </aside>
    <small>&copy; 2015 Christian. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://jekyll.gtat.me/about">Balzac</a> theme.</small>
  </footer>

  <!-- If they're out, get some from the cellar -->
  <script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
  <script src="/assets/js/retina.min.js"></script>

  <!-- Custom JS -->
  <script src="/assets/js/scripts.js"></script>
  

  </body>
</html>
